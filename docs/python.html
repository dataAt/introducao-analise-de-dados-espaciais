<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Python ‚ú® | intro-analise-de-dados-espaciais.utf8.md</title>
  <meta name="description" content="" />
  <meta name="generator" content="bookdown 0.14 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Python ‚ú® | intro-analise-de-dados-espaciais.utf8.md" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Python ‚ú® | intro-analise-de-dados-espaciais.utf8.md" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="introducao-ao-r.html"/>
<link rel="next" href="introducao-ao-postgis.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="introducao.html"><a href="introducao.html"><i class="fa fa-check"></i><b>1</b> Introdu√ß√£o</a></li>
<li class="chapter" data-level="2" data-path="introducao-ao-r.html"><a href="introducao-ao-r.html"><i class="fa fa-check"></i><b>2</b> Introdu√ß√£o ao R üíé</a></li>
<li class="chapter" data-level="3" data-path="python.html"><a href="python.html"><i class="fa fa-check"></i><b>3</b> Python ‚ú®</a><ul>
<li class="chapter" data-level="3.1" data-path="python.html"><a href="python.html#pandas"><i class="fa fa-check"></i><b>3.1</b> Pandas üêº</a><ul>
<li class="chapter" data-level="3.1.1" data-path="python.html"><a href="python.html#manipulacao-de-dados"><i class="fa fa-check"></i><b>3.1.1</b> Manipula√ß√£o de dados</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="python.html"><a href="python.html#geopandas"><i class="fa fa-check"></i><b>3.2</b> GeoPandas üåéüêº</a><ul>
<li class="chapter" data-level="3.2.1" data-path="python.html"><a href="python.html#geoseries-e-geodataframes"><i class="fa fa-check"></i><b>3.2.1</b> GeoSeries e GeoDataFrames</a></li>
<li class="chapter" data-level="3.2.2" data-path="python.html"><a href="python.html#leitura-e-escrita-de-dados"><i class="fa fa-check"></i><b>3.2.2</b> Leitura e escrita de dados</a></li>
<li class="chapter" data-level="3.2.3" data-path="python.html"><a href="python.html#manipulacao-geometrica"><i class="fa fa-check"></i><b>3.2.3</b> Manipula√ß√£o geom√©trica</a></li>
<li class="chapter" data-level="3.2.4" data-path="python.html"><a href="python.html#selecao-e-filtro-de-dados"><i class="fa fa-check"></i><b>3.2.4</b> Sele√ß√£o e filtro de dados</a></li>
<li class="chapter" data-level="3.2.5" data-path="python.html"><a href="python.html#manipulacao-de-projecoes"><i class="fa fa-check"></i><b>3.2.5</b> Manipula√ß√£o de proje√ß√µes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="introducao-ao-postgis.html"><a href="introducao-ao-postgis.html"><i class="fa fa-check"></i><b>4</b> Introdu√ß√£o ao postgis üêò</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="python" class="section level1">
<h1><span class="header-section-number">3</span> Python ‚ú®</h1>
<p>Python √© uma linguagem de programa√ß√£o vers√°til, multiparadigma, que permite aos desenvolvedores criar r√°pidas solu√ß√µes para seus problemas sem grandes preocupa√ß√µes com a sintaxe e formas de uso da linguagem.</p>
<p>Tais caracter√≠sticas fizem Python alcan√ßar os mais variados nichos de aplica√ß√£o. Por ser uma linguagem geral para atingir tais nichos, foram criadas pela comunidade de Python diversas bibliotecas, todas seguindo a ideia da simplicidade de aplica√ß√£o e prototipa√ß√£o da linguagem. √â neste contexto que surge o GeoPandas, que fornece extens√µes de uso espacial para uma biblioteca de an√°lise de dados muito conhecida na comunidade Python, o Pandas.</p>
<p>Desta forma, este cap√≠tulo busca explicar as principais formas de utiliza√ß√£o do GeoPandas. Por ser baseada no Pandas, h√° uma pequena se√ß√£o que trata sobre o uso b√°sico da linguagem, mas √© recomendado que o leitor tamb√©m conhe√ßa tal biblioteca, para isto, existe o <a href="https://dataat.github.io/introducao-analise-de-dados/introducao.html">curso de introdu√ß√£o √† an√°lise de dados</a>, que explica os principais conceitos de utiliza√ß√£o do Pandas, n√£o deixe de conferir!</p>
<div id="pandas" class="section level2">
<h2><span class="header-section-number">3.1</span> Pandas üêº</h2>
<p>Com a necessidade de facilitar todo o processo de an√°lise de dados, atrav√©s de uma linguagem simples e amig√°vel, a comunidade Python criou o Pandas, uma biblioteca que disponibiliza m√©todos de alto n√≠vel para a manipula√ß√£o, processamento e an√°lise dos mais variados tipos de dados.</p>
<p>Atrav√©s dos m√©todos desta biblioteca √© poss√≠vel aplicar todo o ciclo de an√°lise de dados, este indo desde a coleta at√© o processamento e an√°lise. Para realizar tais atividades, o pandas disponibiliza diversas estruturas de dados, sendo as <code>Series</code> e os <code>DataFrames</code> as principais.</p>
<p>Cada uma dessas estruturas de dados, trata especificamente de uma forma de realizar a abstra√ß√£o do formato dos dados em c√≥digo, isto faz com que seja necess√°rio o entendimento das principais diferentes entre cada uma delas, para que seja poss√≠vel realizar sua correta aplica√ß√£o. Vamos buscar comparar cada uma dessas estruturas para entender suas diferen√ßas.</p>
<p>As <code>Series</code> s√£o estruturas de dados unidimensionais, possuindo apenas uma dimens√£o que pode ser manipulada, tal dimens√£o sendo chamada de √≠ndice. J√° os <code>DataFrames</code> apresentam duas dimens√µes para a manipula√ß√£o.</p>
<p>Estas caracter√≠sticas, na pr√°tica, indicam que, as <code>Series</code> apenas representar vetores, enquanto os <code>DataFrames</code> podem representar matrizes de N-Dimens√µes. Para esta ideia ficar clara, vejamos a Figura abaixo.</p>
<center>
<div style="width:500px; height:400px">
<p><img src="res/3_python/series_vs_dataframe.svg" /></p>
</div>
</center>
<p>Perceba que, as <code>Series</code> possuem o campo para o armazenamento dos dados (Representado em Azul), e o √≠ndice (Representado em roxo), n√£o podendendo ser adicionado nenhum outro campo, isto faz com que, todos os dados tenham de ser armazenados em apenas uma coluna, em v√°rias linhas.</p>
<p>Para o <code>DataFrame</code> o cen√°rio apresentado na Figura √© diferente, al√©m dos √≠ndices, h√° tamb√©m as colunas (Representada em vermelho), o que permite que dentro desta estrutura existam n√£o s√≥ um conjunto de linhas, como as <code>Series</code> mas sim um conjunto de colunas, onde cada uma dessas possuem v√°rias linhas. Na pr√°tica o que fica subentendido √© que, os <code>DataFrames</code> s√£o um conjunto de <code>Series</code>.</p>
<center>
<img src="res/3_python/relacoes_pandas.svg" />
</center>
<p>Isto ocorre j√° que, cada uma das colunas criadas dentro do <code>DataFrame</code> s√£o <code>Series</code>, o que acaba gerando um efeito muito interessante na API do Pandas, boa parte dos m√©todos dispon√≠veis para as <code>Series</code> tamb√©m est√£o presentes nos <code>DataFrames</code>. Vamos ver alguns exemplos em c√≥digo para fixar a diferen√ßa entre essas duas estruturas de dados.</p>
<div id="manipulacao-de-dados" class="section level3">
<h3><span class="header-section-number">3.1.1</span> Manipula√ß√£o de dados</h3>
<p>Vamos come√ßar criando uma <code>Series</code>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb1-1" title="1"><span class="im">import</span> pandas <span class="im">as</span> pd</a>
<a class="sourceLine" id="cb1-2" title="2"></a>
<a class="sourceLine" id="cb1-3" title="3">sr <span class="op">=</span> pd.Series([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</a></code></pre></div>
<p>Pronto! Acabamos de criar uma <code>Series</code> com uma lista de valores, vejamos como ela est√° sendo representada.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb2-1" title="1"><span class="bu">print</span>(sr)</a></code></pre></div>
<pre><code>## 0    1
## 1    2
## 2    3
## 3    4
## 4    5
## dtype: int64</code></pre>
<p>A representa√ß√£o est√° da mesma forma que vimos antes. Vamos agora fazer uma pequena manipula√ß√£o dos dados, para isto, utilizaremos os m√©todos <code>loc</code> e <code>iloc</code> dispon√≠veis dentro do objeto <code>Series</code> gerado, onde o m√©todo <code>loc</code> busca o √≠ndice com o nome inserido e o <code>iloc</code> busca o √≠ndice com a posi√ß√£o inserida. A assinatura de cada um dos m√©todos est√° descrita abaixo. Lembre-se que este m√©todo est√° presente tanto na classe <code>Series</code> como na classe <code>DataFrame</code>.</p>
<table>
<thead>
<tr class="header">
<th>DataFrame</th>
<th align="center">Series</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>.loc[linha, coluna]</td>
<td align="center">.loc[linha]</td>
</tr>
<tr class="even">
<td>.iloc[linha]</td>
<td align="center">.iloc[linha]</td>
</tr>
</tbody>
</table>
<p>Antes de fazermos o teste destes m√©todos, vamos alterar o √≠ndice da nossa <code>Series</code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb4-1" title="1"><span class="co"># Vamos visualizar o √≠ndice</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="bu">print</span>(sr.index)</a></code></pre></div>
<pre><code>## RangeIndex(start=0, stop=5, step=1)</code></pre>
<p>O atributo <code>index</code> devolve os elementos que est√£o no √≠ndice, para fazer sua mudan√ßa, basta realizar uma atribui√ß√£o, veja.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb6-1" title="1">sr.index <span class="op">=</span> [<span class="st">&quot;um&quot;</span>, <span class="st">&quot;dois&quot;</span>, <span class="st">&quot;tres&quot;</span>, <span class="st">&quot;quatro&quot;</span>, <span class="st">&quot;cinco&quot;</span>]</a>
<a class="sourceLine" id="cb6-2" title="2"></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="bu">print</span>(sr.index)</a></code></pre></div>
<pre><code>## Index([&#39;um&#39;, &#39;dois&#39;, &#39;tres&#39;, &#39;quatro&#39;, &#39;cinco&#39;], dtype=&#39;object&#39;)</code></pre>
<p>Fizemos esta mudan√ßa, para que cada um dos m√©todos <code>loc</code> e <code>iloc</code> seja mais simples de entender. Certo, vamos come√ßar buscando a linha que tenha o nome <code>dois</code>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb8-1" title="1"><span class="bu">print</span>(sr.loc[<span class="st">&quot;dois&quot;</span>])</a></code></pre></div>
<pre><code>## 2</code></pre>
<p>Agora vamos buscar a linha que est√° na posi√ß√£o dois.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb10-1" title="1"><span class="bu">print</span>(sr.iloc[<span class="dv">1</span>]) <span class="co"># Lembre-se, o Python come√ßa a contar no zero =D</span></a></code></pre></div>
<pre><code>## 2</code></pre>
<p>Percebeu? Temos o mesmo resultado, muito interessante n√£o ? Al√©m disso ainda posso aplicar filtros sob os dados,utilizando o conceito de <code>indexa√ß√£o booleana</code>, onde atrav√©s de um vetor de <code>VERDADEIRO</code> e <code>FALSO</code> √© poss√≠vel selecionar as linhas.</p>
<p>Vamos buscar somente os valores que s√£o acima de tr√™s.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb12-1" title="1"><span class="bu">print</span>(sr[sr <span class="op">&gt;</span> <span class="dv">3</span>])</a></code></pre></div>
<pre><code>## quatro    4
## cinco     5
## dtype: int64</code></pre>
<blockquote>
<p>Dica: O que ocorre nesta parte √©, dentro das chaves de <code>sr</code> (sr[]) √© passado a express√£o <code>sr &gt; 3</code> que devolve uma lista de verdadeiros e falsos, fazendo assim o filtro.</p>
</blockquote>
<p>Muito interessante! Mas at√© aqui trabalhamos com apenas uma dimens√£o, vamos tentar acrescentar mais, para isto, primeiro vamos criar uma matriz.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb14-1" title="1">matriz <span class="op">=</span> [</a>
<a class="sourceLine" id="cb14-2" title="2">  [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>], [<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>]</a>
<a class="sourceLine" id="cb14-3" title="3">]</a></code></pre></div>
<p>A matriz criada √© representada por uma lista de listas. Vamos tentar criar uma <code>Series</code> com esta matriz.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb15-1" title="1">sr <span class="op">=</span> pd.Series(matriz)</a>
<a class="sourceLine" id="cb15-2" title="2"></a>
<a class="sourceLine" id="cb15-3" title="3"><span class="bu">print</span>(sr)</a></code></pre></div>
<pre><code>## 0    [1, 2, 3]
## 1    [4, 5, 6]
## dtype: object</code></pre>
<p>Eita! Perceba que, em cada linha h√° uma lista de valores, o que √© ruim! J√° que a manipula√ß√£o fica dif√≠cil (Tenta fazer uma indexa√ß√£o booleana, vai falhar üò¢).</p>
<p>Para este caso, existem os <code>DataFrames</code>! Vamos come√ßar criando um com a mesma matriz gerada anteriormente.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb17-1" title="1">df <span class="op">=</span> pd.DataFrame(matriz)</a>
<a class="sourceLine" id="cb17-2" title="2"></a>
<a class="sourceLine" id="cb17-3" title="3"><span class="bu">print</span>(df)</a></code></pre></div>
<pre><code>##    0  1  2
## 0  1  2  3
## 1  4  5  6</code></pre>
<p>Opa! Agora o cen√°rio √© outro, conseguimos colocar cada um dos valores em seu devido lugar. Perceba que a representa√ß√£o mudou bastante, aqui temos v√°rias colunas de dados, e mesmo assim, todos os m√©todos j√° apresentados at√© aqui funcionam. Vai l√°, tenta!</p>
<p>Uma coisa importante sobre os <code>DataFrames</code> s√£o suas colunas, para acessar elas podemos fazer da seguinte forma.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb19-1" title="1"><span class="bu">print</span>(df[<span class="dv">0</span>])</a></code></pre></div>
<pre><code>## 0    1
## 1    4
## Name: 0, dtype: int64</code></pre>
<p>Viu! Estamos acessando a primeira coluna, se fizermos a mesma coisa, com a segunda tamb√©m vai funcionar (Tenta inserir o n√∫mero 1, para voc√™ ver o que acontece).</p>
<blockquote>
<p>Dica: Ao fazer df[0], estamos buscando o ‚Äúnome‚Äù da coluna, e n√£o sua posi√ß√£o</p>
</blockquote>
<p>Da mesma forma que eu podemos recuperar o √≠ndice com o atributo <code>index</code> podemos recuperar as colunas com o atributo <code>columns</code></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb21-1" title="1"><span class="bu">print</span>(df.columns)</a></code></pre></div>
<pre><code>## RangeIndex(start=0, stop=3, step=1)</code></pre>
<p>Para fazer a mudan√ßa dos nomes de cada coluna a mesma regra do <code>index</code> √© v√°lida.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb23-1" title="1">df.columns <span class="op">=</span> [<span class="st">&quot;col1&quot;</span>, <span class="st">&quot;col2&quot;</span>, <span class="st">&quot;col3&quot;</span>]</a>
<a class="sourceLine" id="cb23-2" title="2"></a>
<a class="sourceLine" id="cb23-3" title="3"><span class="bu">print</span>(df.columns)</a></code></pre></div>
<pre><code>## Index([&#39;col1&#39;, &#39;col2&#39;, &#39;col3&#39;], dtype=&#39;object&#39;)</code></pre>
<p>Vamos recuperar a primeira coluna novamente</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb25-1" title="1"><span class="bu">print</span>(df[<span class="st">&quot;col1&quot;</span>])</a></code></pre></div>
<pre><code>## 0    1
## 1    4
## Name: col1, dtype: int64</code></pre>
<p>Assim, fica mais f√°cil entender que, quando se trata de colunas, estamos buscando os nomes, e n√£o simplesmente as posi√ß√µes.</p>
<p>Bom, agora que j√° entendemos toda a utiliza√ß√£o b√°sica do Pandas, vamos come√ßar a falar um pouco sobre o GeoPandas üíú</p>
</div>
</div>
<div id="geopandas" class="section level2">
<h2><span class="header-section-number">3.2</span> GeoPandas üåéüêº</h2>
<p>Com o entendimento do que √© a biblioteca Pandas, suas estruturas de dados e principais caracter√≠sticas, o estudo do GeoPandas pode ser iniciado. Mas o que √© o GeoPandas ?</p>
<blockquote>
<p>GeoPandas √© um projeto open-source que busca facilitar o trabalho com dados vetoriais em Python, para isto, tem como base as estruturas de dados do Pandas</p>
</blockquote>
<p>Desta forma, a ideia b√°sica por tr√°s do GeoPandas √© adicionar o suporte a manipula√ß√£o de dados espaciais as estruturas de dados do Pandas, e com isto prover formas de manipula√ß√£o simples e direta a tais dados.</p>
<p>Para fazer isto, o GeoPandas utiliza estruturas de dados geom√©tricas implementadas pela biblioteca <a href="https://shapely.readthedocs.io/en/stable/manual.html">Shapely</a> dentro das <code>Series</code> e dos <code>DataFrames</code>. Com esta adi√ß√£o, duas estruturas de dados surgem, as <code>GeoSeries</code> e os <code>GeoDataFrames</code>.</p>
<p>Este conceito pode ser melhor entendido com a observa√ß√£o da Figura abaixo.</p>
<center>
<img src="res/3_python/relacoes_pandas_e_geopandas.svg" />
</center>
<p>Perceba que, h√° a mesma estrutura que foi apresentada na se√ß√£o anterior, com as geometrias sendo o diferencial nas estruturas de dados.</p>
<p>Na pr√°tica o que ocorre √©, todas as formas de manipula√ß√£o geom√©tricas, que como citadas s√£o implementadas com o Shapely, s√£o implementadas em uma classe <code>GeoPandasBase</code> que √© extendida pelas <code>GeoSeries</code> e <code>GeoDataFrames</code>, da mesma forma, essas tamb√©m extendem as estruturas de dados equivalentes do Pandas, veja a Figura abaixo.</p>
<center>
<img src="res/3_python/geopandas_classes.svg" />
</center>
<p>Como a <code>GeoSeries</code> e os <code>GeoDataFrames</code> s√£o especializa√ß√µes diretas das <code>Series</code> e dos <code>DataFrames</code> as mesmas caracter√≠sticas s√£o mantidas, onde, respectivamente, um armazena apenas uma coluna de valores, tendo uma dimens√£o de manipula√ß√£o e o outro armazena diversas colunas com duas dimens√µes de manipula√ß√£o, da mesma forma como apresentado na se√ß√£o anterior.</p>
<p>Para fixar o funcionamento de cada uma dessas estruturas, vamos fazer alguns testes com a API do GeoPandas.</p>
<div id="geoseries-e-geodataframes" class="section level3">
<h3><span class="header-section-number">3.2.1</span> GeoSeries e GeoDataFrames</h3>
<p>Para come√ßar os testes, vamos importar a biblioteca de geometrias, <code>Shapely</code> e o GeoPandas.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb27-1" title="1"><span class="im">import</span> shapely</a>
<a class="sourceLine" id="cb27-2" title="2"><span class="im">import</span> geopandas <span class="im">as</span> gpd</a></code></pre></div>
<p>Agora, vamos criar uma <code>GeoSeries</code>.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb28-1" title="1">gsr <span class="op">=</span> gpd.GeoSeries([</a>
<a class="sourceLine" id="cb28-2" title="2">  shapely.geometry.Point(<span class="dv">1</span>, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb28-3" title="3">])</a></code></pre></div>
<blockquote>
<p>Dica: A geometria criada n√£o possui qualquer tipo de refer√™ncia espacial, portanto representa apenas um ponto no plano cartesiano.</p>
</blockquote>
<p>Veja que acabamos de criar uma <code>GeoSeries</code> que armazena uma geometria de ponto, vamos visualizar o objeto criado.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb29-1" title="1"><span class="bu">print</span>(gsr)</a></code></pre></div>
<pre><code>## 0    POINT (1.00000 1.00000)
## dtype: geometry</code></pre>
<p>A forma √© exatamente a mesma de uma <code>Series</code>. Vamos criar um novo objeto com mais geometrias inseridas.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb31-1" title="1">gsr <span class="op">=</span> gpd.GeoSeries([</a>
<a class="sourceLine" id="cb31-2" title="2">  shapely.geometry.Point(<span class="dv">1</span>, <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb31-3" title="3">  shapely.geometry.Point(<span class="dv">2</span>, <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb31-4" title="4">  shapely.geometry.Point(<span class="dv">4</span>, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb31-5" title="5">])</a>
<a class="sourceLine" id="cb31-6" title="6"></a>
<a class="sourceLine" id="cb31-7" title="7"><span class="bu">print</span>(gsr)</a></code></pre></div>
<pre><code>## 0    POINT (1.00000 1.00000)
## 1    POINT (2.00000 2.00000)
## 2    POINT (4.00000 3.00000)
## dtype: geometry</code></pre>
<p>Caso eu queira visualizar n√£o s√≥ a tabela, mas sim a representa√ß√£o das geometrias criadas no espa√ßo, √© poss√≠vel utilizar o m√©todo <code>plot</code>.</p>
<pre><code>gsr.plot()</code></pre>
<center>
<pre><code>## &lt;matplotlib.axes._subplots.AxesSubplot object at 0x0000028127D5D0B8&gt;</code></pre>
<img src="intro-analise-de-dados-espaciais_files/figure-html/unnamed-chunk-21-1.png" width="576" />
</center>
<p>Mas as <code>GeoSeries</code> podem ser limitadas em alguns casos, imagine que para a realiza√ß√£o de um estudo seja necess√°rio n√£o s√≥ a geolocaliza√ß√£o ou a representa√ß√£o geom√©trica no espa√ßo, mas tamb√©m caracter√≠sticas do ambiente, qualquer tipo de informa√ß√£o que n√£o a espacial. Nestes casos podemos utilizar os <code>GeoDataFrames</code> que al√©m de colunas de geometria permitem o armazenamento de outras informa√ß√µes, isto por permitir multiplas colunas. Vamos criar um para fazer testes.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb35-1" title="1">gdf <span class="op">=</span> gpd.GeoDataFrame({</a>
<a class="sourceLine" id="cb35-2" title="2">  <span class="st">&#39;atributo_a&#39;</span>: [<span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>],</a>
<a class="sourceLine" id="cb35-3" title="3">  <span class="st">&#39;geometria&#39;</span>: [</a>
<a class="sourceLine" id="cb35-4" title="4">    shapely.geometry.Point(<span class="dv">1</span>, <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb35-5" title="5">    shapely.geometry.Point(<span class="dv">2</span>, <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb35-6" title="6">    shapely.geometry.Point(<span class="dv">4</span>, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb35-7" title="7">  ]</a>
<a class="sourceLine" id="cb35-8" title="8">})</a></code></pre></div>
<p>Visualizando o resultado</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb36-1" title="1"><span class="bu">print</span>(gdf)</a></code></pre></div>
<pre><code>##    atributo_a    geometria
## 0          10  POINT (1 1)
## 1          11  POINT (2 2)
## 2          12  POINT (4 3)</code></pre>
<p>Agora as geometrias passam a ser vinculadas com outros valores, o que pode ser muito √∫til em v√°rios cen√°rios. At√© aqui foram criadas geometrias sem nenhum tipo de liga√ß√£o com o mundo real, ent√£o, vamos agora trabalhar um pouco com dados que fa√ßam esta representa√ß√£o, para isto, vejamos como carregar dados espaciais com o GeoPandas.</p>
</div>
<div id="leitura-e-escrita-de-dados" class="section level3">
<h3><span class="header-section-number">3.2.2</span> Leitura e escrita de dados</h3>
<p>Al√©m de todas as caracter√≠sticas citadas at√© aqui, o GeoPandas ainda ajuda na leitura e na escrita de dados vetoriais, tudo seguindo o padr√£o de facilidade de uso do Pandas.</p>
<p>Para realizar essas opera√ß√µes o GeoPandas utiliza como base a biblioteca <a href="https://fiona.readthedocs.io/en/latest/manual.html">Fiona</a>, que traz suporte a leitura e escrita de uma enorme variedade de formatos vetoriais, sendo alguns deles:</p>
<ul>
<li>GeoJSON;</li>
<li>GPSTrackMaker;</li>
<li>ESRI Shapefile;</li>
<li>FileGDB;</li>
<li>OpenFileGDB.</li>
</ul>
<p>Al√©m destes formatos a biblioteca aceita v√°rios outros, para a lista completa de formatos suportados, consulte a <a href="https://fiona.readthedocs.io/en/latest/manual.html">documenta√ß√£o</a> do Fiona.</p>
<p>Para fazer alguns testes utilizando as funcionalidades de leitura dos dados, vamos carregar um dado vetorial, dos estados do Brasil que est√£o armazenados em um <code>shapefile</code>.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb38-1" title="1">gdf <span class="op">=</span> gpd.read_file(<span class="st">&quot;../data/1_estados_do_brasil_shape/Brasil.shp&quot;</span>)</a></code></pre></div>
<blockquote>
<p>Estes dados est√£o dispon√≠veis no <a href="https://github.com/dataAt/introducao-analise-de-dados-espaciais/tree/master/data">reposit√≥rio</a> do curso.</p>
</blockquote>
<p>Com os dados carregados, vamos visualizar qual foi a estrutura gerada ao carregar os dados.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb39-1" title="1"><span class="bu">print</span>(<span class="bu">type</span>(gdf))</a></code></pre></div>
<pre><code>## &lt;class &#39;geopandas.geodataframe.GeoDataFrame&#39;&gt;</code></pre>
<p>Um <code>GeoDataFrame</code>! Isto √© feito por padr√£o pela biblioteca, assim, independente do formato de entrada, o GeoPandas busca inserir os dados dentro de um <code>GeoDataFrame</code>. Certo, vamos olhar ent√£o o que est√° dentro deste objeto.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb41-1" title="1"><span class="bu">print</span>(gdf.head(<span class="dv">5</span>))</a></code></pre></div>
<pre><code>##     ESTADOS    REGIAO  ...  UF                                           geometry
## 0      Acre     Norte  ...  AC  POLYGON ((-73.80098 -7.11145, -73.74084 -7.143...
## 1   Alagoas  Nordeste  ...  AL  MULTIPOLYGON (((-36.39119 -10.50082, -36.39864...
## 2     Amap√°     Norte  ...  AP  MULTIPOLYGON (((-51.37380 -0.37053, -51.37337 ...
## 3  Amazonas     Norte  ...  AM  POLYGON ((-73.80098 -7.11145, -73.80106 -7.111...
## 4     Bahia  Nordeste  ...  BA  MULTIPOLYGON (((-46.32975 -13.25248, -46.33072...
## 
## [5 rows x 5 columns]</code></pre>
<p>√â poss√≠vel perceber neste resultado que, ao carregar os dados, as representa√ß√µes espaciais presentes no arquivo, foram inseridas em uma coluna chamada <code>geometry</code> e que, al√©m dessa coluna, existem outras que vinculam m√∫ltiplas informa√ß√µes a cada uma das representa√ß√µes espaciais presentes no arquivo.</p>
<blockquote>
<p>Lembre-se, o m√©todo <code>head</code> √© herdado do Pandas, ele possibilita a visualiza√ß√£o das linhas iniciais da tabela de dados.</p>
</blockquote>
<p>A representa√ß√£o acima n√£o nos mostra todas as colunas de informa√ß√µes que temos no conjunto de dados carregados, para saber quais s√£o todas elas, utilizaremos o atributo <code>columns</code>.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb43-1" title="1"><span class="bu">print</span>(gdf.columns)</a></code></pre></div>
<pre><code>## Index([&#39;ESTADOS&#39;, &#39;REGIAO&#39;, &#39;COD_UF&#39;, &#39;UF&#39;, &#39;geometry&#39;], dtype=&#39;object&#39;)</code></pre>
<p>Olha que interessante! Para cada estado, h√° seu nome, a regi√£o a que pertence, sua Unidade da Federa√ß√£o (UF) e o c√≥digo desta UF. Agora que j√° sabemos como est√£o nossos dados, vamos voltar um pouco na coluna <code>geometry</code>.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb45-1" title="1"><span class="bu">print</span>(gdf[<span class="st">&quot;geometry&quot;</span>].head(<span class="dv">5</span>))</a></code></pre></div>
<pre><code>## 0    POLYGON ((-73.80098 -7.11145, -73.74084 -7.143...
## 1    MULTIPOLYGON (((-36.39119 -10.50082, -36.39864...
## 2    MULTIPOLYGON (((-51.37380 -0.37053, -51.37337 ...
## 3    POLYGON ((-73.80098 -7.11145, -73.80106 -7.111...
## 4    MULTIPOLYGON (((-46.32975 -13.25248, -46.33072...
## Name: geometry, dtype: geometry</code></pre>
<p>Entenda, a geometria escolhida para representar cada um dos estados do Brasil foi o poligono, e isto √© poss√≠vel de visualizar na coluna <code>geometry</code>. Outro fato importante sobre esta coluna √© que, ela n√£o precisa ter este nome, ele √© definido automaticamente pelo GeoPandas para que as coisas sejam padronizadas e fiquem mais simples, mas, caso eu queira alterar, posso fazer isto facilmente da seguinte forma.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb47-1" title="1">gdf <span class="op">=</span> gdf.rename_geometry(<span class="st">&quot;geometria&quot;</span>)</a></code></pre></div>
<p>Ao fazer isto, vamos visualizar as colunas do <code>GeoDataFrame</code> alterado.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb48-1" title="1"><span class="bu">print</span>(gdf.columns)</a></code></pre></div>
<pre><code>## Index([&#39;ESTADOS&#39;, &#39;REGIAO&#39;, &#39;COD_UF&#39;, &#39;UF&#39;, &#39;geometria&#39;], dtype=&#39;object&#39;)</code></pre>
<p>Mas, e se nos dados que eu estiver carregando existirem mais de uma coluna de representa√ß√µes espaciais, como o GeoPandas entende qual deve ser utilizada? Bem, por padr√£o ele escolhera a primeira delas e a tratar√° como a coluna <code>geometry</code> do conjunto de dados, por√©m se eu quiser fazer a altera√ß√£o, tamb√©m √© poss√≠vel.</p>
<p>Primeiro, vamos aprender a identificar como o GeoPandas mostra a coluna que ele est√° utilizando como padr√£o, para isto o atributo <code>geometry</code> √© utilizado.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb50-1" title="1"><span class="bu">print</span>(gdf.geometry.head(<span class="dv">5</span>))</a></code></pre></div>
<pre><code>## 0    POLYGON ((-73.80098 -7.11145, -73.74084 -7.143...
## 1    MULTIPOLYGON (((-36.39119 -10.50082, -36.39864...
## 2    MULTIPOLYGON (((-51.37380 -0.37053, -51.37337 ...
## 3    POLYGON ((-73.80098 -7.11145, -73.80106 -7.111...
## 4    MULTIPOLYGON (((-46.32975 -13.25248, -46.33072...
## Name: geometria, dtype: geometry</code></pre>
<p>Este atributo devolve os dados da coluna padr√£o de geometrias. Vamos ver qual √© o nome da coluna de onde ele retira tais dados.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb52-1" title="1"><span class="bu">print</span>(gdf.geometry.name)</a></code></pre></div>
<pre><code>## geometria</code></pre>
<p>O nome √© exatamente o mesmo da coluna que renomeamos! Vamos trocar esta coluna padr√£o, para fazer este teste, vou duplicar a coluna que cont√©m as geometrias, por√©m cada uma ter√° um nome.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb54-1" title="1">gdf[<span class="st">&quot;geometria_dois&quot;</span>] <span class="op">=</span> gdf[<span class="st">&quot;geometria&quot;</span>]</a>
<a class="sourceLine" id="cb54-2" title="2"></a>
<a class="sourceLine" id="cb54-3" title="3"><span class="bu">print</span>(gdf.columns)</a></code></pre></div>
<pre><code>## Index([&#39;ESTADOS&#39;, &#39;REGIAO&#39;, &#39;COD_UF&#39;, &#39;UF&#39;, &#39;geometria&#39;, &#39;geometria_dois&#39;], dtype=&#39;object&#39;)</code></pre>
<p>Feito isto, vamos alterar a coluna padr√£o de geometrias</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb56-1" title="1">gdf <span class="op">=</span> gdf.set_geometry(<span class="st">&quot;geometria_dois&quot;</span>)</a></code></pre></div>
<p>Ao visualizar o resultado, percebemos que a mudan√ßa foi realizada com sucesso.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb57-1" title="1"><span class="bu">print</span>(gdf.geometry.name)</a></code></pre></div>
<pre><code>## geometria_dois</code></pre>
<blockquote>
<p>A diferen√ßa entre o m√©todo <code>rename_geometry</code> e <code>set_geometry</code> est√° no ponto em que, a <code>set_geometry</code> altera a coluna que est√° sendo considerada como padr√£o para geometrias, equanto a <code>rename_geometry</code> altera o nome da coluna padr√£o de geometrias.</p>
</blockquote>
<p>Por fim, vamos visualizar a disposi√ß√£o destes dados em uma figura, para isto, utilizamos o m√©todo <code>plot</code>.</p>
<pre><code>gdf.plot()</code></pre>
<pre><code>## &lt;matplotlib.axes._subplots.AxesSubplot object at 0x0000028127D8C160&gt;</code></pre>
<p><img src="intro-analise-de-dados-espaciais_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
<p>O ponto a ser entendido do m√©todo <code>plot</code> √© que, ele utiliza a coluna de geometrias padr√£o para gerar a figura, ent√£o, caso haja alguma inconsist√™ncia neste coluna este m√©todo ter√° problemas. Esta l√≥gica se aplica a todos os outros m√©todos do GeoPandas que utilizam a representa√ß√£o espacial para fazer as opera√ß√µes.</p>
<p>Vamos salvar os resultados em um arquivo <code>shapefile</code>, para isto, fa√ßamos a utiliza√ß√£o do m√©todo <code>to_file</code>.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb61-1" title="1"><span class="kw">del</span> gdf[<span class="st">&quot;geometria&quot;</span>] <span class="co"># Removendo coluna extra de geometrias</span></a>
<a class="sourceLine" id="cb61-2" title="2"></a>
<a class="sourceLine" id="cb61-3" title="3">gdf.to_file(<span class="st">&#39;tmp/estados_do_brasil_editado.shp&#39;</span>)</a></code></pre></div>
<p>N√£o deixe de consultar a documenta√ß√£o do Pandas e do GeoPandas, por conta das bibliotecas trabalharem juntas, muitos formas de dados podem ser escritos e tratados, no GeoPandas √© poss√≠vel at√© mesmo ler dados diretamente de um banco de dados espacial (PostGres com PostGIS).</p>
</div>
<div id="manipulacao-geometrica" class="section level3">
<h3><span class="header-section-number">3.2.3</span> Manipula√ß√£o geom√©trica</h3>
<p>O GeoPandas oferece diferentes m√©todos para a manipula√ß√£o dos dados espaciais carregados, esta se√ß√£o far√° a apresenta√ß√£o de alguns destes m√©todos.</p>
<blockquote>
<p>√â importante lembrar que, todos estes m√©todos est√£o orientados a coluna de geometria padr√£o, vista na subse√ß√£o anterior.</p>
</blockquote>
<p>As opera√ß√µes apresentadas nas subse√ß√µes a seguir, s√£o representadas por m√©todos e atributos das <code>GeoSeries</code> e dos <code>GeoDataFrames</code>.</p>
<div id="area" class="section level4">
<h4><span class="header-section-number">3.2.3.1</span> area</h4>
<p>Vamos come√ßar com as opera√ß√µes de √°rea, que de forma an√°loga ao nome, c√°lcula a √°rea da geometria em quest√£o. Vejamos a Figura abaixo que faz uma representa√ß√£o desta opera√ß√£o em diferentes formas geom√©tricas.</p>
<p><img src="res/3_python/opgeom_area.svg" /></p>
<p>O resultado da opera√ß√£o, devolve o c√°lculo da √°rea, representado em vermelho na Figura acima. Para exemplificar, vamos utilizar o conjunto de dados dos estados do Brasil</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb62-1" title="1">estados_do_brasil <span class="op">=</span> gpd.read_file(<span class="st">&quot;../data/1_estados_do_brasil_shape/Brasil.shp&quot;</span>)</a></code></pre></div>
<blockquote>
<p>Lembre-se, este conjunto de dados est√° dispon√≠vel no <a href="https://github.com/dataAt/introducao-analise-de-dados-espaciais/tree/master/data">reposit√≥rio</a> do curso</p>
</blockquote>
<p>Depois de carregar os dados, vamos utilizar o atributo <code>area</code>, que realiza a opera√ß√£o e devolve a √†rea para cada uma das linhas do conjunto de dados</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb63-1" title="1"><span class="bu">print</span>(estados_do_brasil.area.head(<span class="dv">5</span>)) <span class="co"># Exibindo somente as 5 primeiras</span></a></code></pre></div>
<pre><code>## 0     12.553132
## 1      2.285972
## 2     11.424936
## 3    128.108383
## 4     46.911114
## dtype: float64</code></pre>
<p>A √°rea √© devolvida na unidade de medida da proje√ß√£o espacial utilizada no conjunto de dados, estes detalhes ser√£o apresentados nas se√ß√µes seguintes.</p>
</div>
<div id="bounds" class="section level4">
<h4><span class="header-section-number">3.2.3.2</span> bounds</h4>
<p>O atributo <code>bounds</code> devolve as coordenadas m√≠nimas e m√°ximas da regi√£o coberta pela geometria. Sua representa√ß√£o √© feita na Figura abaixo.</p>
<p><img src="res/3_python/opgeom_bounds.svg" /></p>
<p>Perceba que, para cada figura √© criado um ret√¢ngulo que a envolve (Tamb√©m chamado de ret√¢ngulo envolvente) e as coordenadas m√≠nimas e m√°ximas s√£o retiradas desses. Vejamos um exemplo</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb65-1" title="1"><span class="bu">print</span>(estados_do_brasil.bounds.head(<span class="dv">5</span>))</a></code></pre></div>
<pre><code>##         minx       miny       maxx      maxy
## 0 -73.990943 -11.144489 -66.619331 -7.111453
## 1 -38.237442 -10.500822 -35.151669 -8.812208
## 2 -54.875779  -1.235830 -49.875779  4.437122
## 3 -73.801055  -9.814097 -56.097385  2.247063
## 4 -46.629029 -18.349041 -37.339928 -8.532272</code></pre>
</div>
<div id="centroid" class="section level4">
<h4><span class="header-section-number">3.2.3.3</span> centroid</h4>
<p>O atributo <code>centroid</code> devolve o ponto central da geometria. Sua representa√ß√£o √© feita na Figura abaixo.</p>
<p><img src="res/3_python/opgeom_centroid.svg" /></p>
<p>O ponto retornado para cada geometria √© apresentado em vermelho. Vejamos um exemplo com o GeoPandas.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb67-1" title="1">centroids_dos_estados <span class="op">=</span> estados_do_brasil.centroid</a></code></pre></div>
<p>Se olharmos para o resultado teremos uma <code>GeoSeries</code> com um ponto para cada um dos estados, vamos visualizar estes pontos rapidamente.</p>
<pre><code>centroids_dos_estados.plot()</code></pre>
<pre><code>## &lt;matplotlib.axes._subplots.AxesSubplot object at 0x0000028127FE7048&gt;</code></pre>
<p><img src="intro-analise-de-dados-espaciais_files/figure-html/unnamed-chunk-42-1.png" width="672" /></p>
<p>Para fazermos um pequeno experimento, famos pegar a figura com os estados e fazer seu plot junto com os centroids.</p>
<pre><code>base = estados_do_brasil.plot()
centroids_dos_estados.plot(ax=base, marker=&quot;o&quot;, color=&quot;red&quot;)</code></pre>
<pre><code>## &lt;matplotlib.axes._subplots.AxesSubplot object at 0x00000281280A92E8&gt;</code></pre>
<p><img src="intro-analise-de-dados-espaciais_files/figure-html/unnamed-chunk-43-1.png" width="672" /></p>
</div>
<div id="buffer" class="section level4">
<h4><span class="header-section-number">3.2.3.4</span> buffer</h4>
<p>O m√©todo <code>buffer</code> cria um circulo entorno de um ponto, e pode ser aplicado em diferentes tipos de an√°lises espaciais. Sua representa√ß√£o √© feita na Figura abaixo.</p>
<center>
<img src="res/3_python/opgeom_buffer.svg" />
</center>
<p>Para testar esta opera√ß√£o, vamos utilizar os <code>centroids</code> extra√≠dos na se√ß√£o anterior.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb72-1" title="1">buffers <span class="op">=</span> centroids_dos_estados.<span class="bu">buffer</span>(<span class="dv">2</span>)</a></code></pre></div>
<p>Da mesma forma que outros m√©todos que trabalham com dist√¢ncias, os valores dependem diretamente das proje√ß√µes espaciais utilizadas. Vamos fazer um plot do resultado gerado sob o mapa dos estados do Brasil.</p>
<pre><code>base = estados_do_brasil.plot()
base = buffers.plot(ax = base, color = &#39;yellow&#39;)

# Adicionando os centroids tamb√©m, para testar =D
centroids_dos_estados.plot(ax = base, color = &#39;red&#39;)</code></pre>
<pre><code>## &lt;matplotlib.axes._subplots.AxesSubplot object at 0x000002812925A4A8&gt;</code></pre>
<p><img src="intro-analise-de-dados-espaciais_files/figure-html/unnamed-chunk-45-1.png" width="672" /></p>
</div>
<div id="envelope" class="section level4">
<h4><span class="header-section-number">3.2.3.5</span> envelope</h4>
<p>Por fim, o m√©todo <code>envelope</code> cria o mesmo ret√¢ngulo envolve utilizado no atributo <code>bounds</code>, com a diferen√ßa que, neste caso a geometria √© devolvida. A representa√ß√£o desta opera√ß√£o √© feita na Figura abaixo.</p>
<center>
<img src="res/3_python/opgeom_envelope.svg" />
</center>
<p>Para testar, vamos pegar os buffers gerados anteriormente e ent√£o gerar seu ret√¢ngulo envolvente.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb75-1" title="1">envelopes <span class="op">=</span> buffers.envelope</a></code></pre></div>
<p>Da mesma forma que nos demais, vamos visualizar o resultado.</p>
<pre><code>base = estados_do_brasil.plot()

envelopes.plot(ax = base, color = &#39;green&#39;)</code></pre>
<pre><code>## &lt;matplotlib.axes._subplots.AxesSubplot object at 0x00000281291E05C0&gt;</code></pre>
<p><img src="intro-analise-de-dados-espaciais_files/figure-html/unnamed-chunk-47-1.png" width="672" /></p>
</div>
</div>
<div id="selecao-e-filtro-de-dados" class="section level3">
<h3><span class="header-section-number">3.2.4</span> Sele√ß√£o e filtro de dados</h3>
<p>O GeoPandas ainda fornece m√©todos para a sele√ß√£o e filtros de dados baseados na posi√ß√£o espacial. Nesta se√ß√£o veremos dois desses, que podem ser muito √∫teis nas mais diversas an√°lises.</p>
<div id="distance" class="section level4">
<h4><span class="header-section-number">3.2.4.1</span> distance</h4>
<p>Vamos come√ßar com o m√©todo <code>distance</code>, que calcula a dist√¢ncia entre duas geometrias. Sua opera√ß√£o √© representada na Figura abaixo.</p>
<center>
<img src="res/3_python/opgeom_distance.svg" />
</center>
<p>Para testar esta opera√ß√£o, vamos carregar dois dados vetoriais, cada um represetando um estado do Brasil.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb78-1" title="1">estado_maranhao <span class="op">=</span> gpd.read_file(<span class="st">&quot;../data/2_estado_sp_shape/shape_estado-sp.shp&quot;</span>)</a>
<a class="sourceLine" id="cb78-2" title="2">estado_saopaulo <span class="op">=</span> gpd.read_file(<span class="st">&quot;../data/3_estado_ma_shape/shape_estado-ma.shp&quot;</span>)</a></code></pre></div>
<p>Vamos visualizar os dois juntos. Nesta visualiza√ß√£o, para ela ter sentido, abaixo dos estados foi fazer o plot do mapa do Brasil.</p>
<pre><code>base = estados_do_brasil.plot()

base = estado_maranhao.plot(ax = base, color = &#39;green&#39;)
estado_saopaulo.plot(ax = base, color = &#39;yellow&#39;)</code></pre>
<pre><code>## &lt;matplotlib.axes._subplots.AxesSubplot object at 0x00000281291A66A0&gt;</code></pre>
<p><img src="intro-analise-de-dados-espaciais_files/figure-html/unnamed-chunk-49-1.png" width="672" /></p>
<p>Certo, vamos calcular a dist√¢ncia entre cada um deles.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb81-1" title="1">distancia <span class="op">=</span> estado_saopaulo.distance(estado_maranhao)</a>
<a class="sourceLine" id="cb81-2" title="2"></a>
<a class="sourceLine" id="cb81-3" title="3"><span class="bu">print</span>(distancia)</a></code></pre></div>
<pre><code>## 0    9.809695
## dtype: float64</code></pre>
<p>Feito, com isto tem-se a dist√¢ncia entre as duas geometrias, que neste caso representa os estados do Maranh√£o e S√£o Paulo. Esta mesma opera√ß√£o pode ser utilizada como uma forma de consulta aos dados, por exemplo, buscar estados que estejam a X de dist√¢ncia de outro.</p>
</div>
<div id="contains" class="section level4">
<h4><span class="header-section-number">3.2.4.2</span> contains</h4>
<p>O m√©todo <code>contains</code> verifica se uma geometria est√° contida em outra, sua representa√ß√£o visual √© apresentada abaixo .</p>
<center>
<img src="res/3_python/opgeom_contains.svg" />
</center>
<p>Vamos fazer um teste da opera√ß√£o com o estado do Amazonas, verificando se sua geometria est√° contida nas nos dados de estados do Brasil.</p>
<p>Primeiro, vamos retirar do <code>GeoDataFrame</code> as informa√ß√µes do estado do Amazonas, para isto aplicaremos um filtro booleano, herdado do Pandas.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb83-1" title="1">estado_amazonas <span class="op">=</span> estados_do_brasil[estados_do_brasil[<span class="st">&quot;ESTADOS&quot;</span>] <span class="op">==</span> <span class="st">&quot;Amazonas&quot;</span>] <span class="co"># Indexa√ß√£o booleana</span></a></code></pre></div>
<p>Agora vamos verificar se o estado est√° contido em alguma geometria dos estados do Brasil.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb84-1" title="1">amazonas_esta_presente <span class="op">=</span> estados_do_brasil.contains(estado_amazonas)</a>
<a class="sourceLine" id="cb84-2" title="2"></a>
<a class="sourceLine" id="cb84-3" title="3"><span class="bu">print</span>(amazonas_esta_presente.head(<span class="dv">10</span>))</a></code></pre></div>
<pre><code>## 0    False
## 1    False
## 2    False
## 3     True
## 4    False
## 5    False
## 6    False
## 7    False
## 8    False
## 9    False
## dtype: bool</code></pre>
<p>Veja que em uma das linhas apareceu <code>True</code>, isto indica que a geometria do estado do Amazonas est√° contida nesta, que se formos olhar a linha do <code>GeoDataFrame</code> com os dados do estado, indica exatamente a linha do estado do Amazonas.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb86-1" title="1"><span class="bu">print</span>(estados_do_brasil[amazonas_esta_presente])</a></code></pre></div>
<pre><code>##     ESTADOS REGIAO  ...  UF                                           geometry
## 3  Amazonas  Norte  ...  AM  POLYGON ((-73.80098 -7.11145, -73.80106 -7.111...
## 
## [1 rows x 5 columns]</code></pre>
</div>
<div id="intersects" class="section level4">
<h4><span class="header-section-number">3.2.4.3</span> intersects</h4>
<p>Por fim, na parte de sele√ß√£o atrav√©s dos dados espaciais, vamos testar o m√©todo <code>intersects</code>, que verifica se uma geometria faz intersec√ß√£o com outra. Vale lembrar que, √© tido como uma intersec√ß√£o, quando um objeto cruza de alguma maneira, seu limite e seu interior com outro objeto. A opera√ß√£o pode ser vista abaixo.</p>
<center>
<img src="res/3_python/opgeom_intersects.svg" />
</center>
<p>Para realizar este teste, vamos carregar um arquivo que cont√©m todos rios do nosso pa√≠s. E ent√£o verificar quais desses fazem intersec√ß√£o com o estado do Par√°.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb88-1" title="1">rios_brasil <span class="op">=</span> gpd.read_file(<span class="st">&quot;../data/4_rios_brasil/Brasil_rios.shp&quot;</span>)</a></code></pre></div>
<p>Antes de continuar, vamos visualizar os dados, junto aos estados do Brasil.</p>
<pre><code>base = estados_do_brasil.plot(color = &quot;gray&quot;)
rios_brasil.plot(ax = base, color = &#39;red&#39;)</code></pre>
<div class="sourceCode" id="cb90"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb90-1" title="1">base <span class="op">=</span> estados_do_brasil.plot(color <span class="op">=</span> <span class="st">&quot;gray&quot;</span>)</a>
<a class="sourceLine" id="cb90-2" title="2">rios_brasil.plot(ax <span class="op">=</span> base, color <span class="op">=</span> <span class="st">&#39;red&#39;</span>)</a></code></pre></div>
<pre><code>## &lt;matplotlib.axes._subplots.AxesSubplot object at 0x000002812508DB38&gt;</code></pre>
<div class="sourceCode" id="cb92"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb92-1" title="1">plt.show()</a></code></pre></div>
<p><img src="intro-analise-de-dados-espaciais_files/figure-html/unnamed-chunk-55-1.png" width="672" /></p>
<p>Agora vamos pegar somente o estado do Par√° do conjunto de estados e verificar quais rios fazem intersec√ß√£o com ele.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb93-1" title="1">estado_para <span class="op">=</span> estados_do_brasil[estados_do_brasil[<span class="st">&quot;ESTADOS&quot;</span>] <span class="op">==</span> <span class="st">&quot;Par√°&quot;</span>]</a>
<a class="sourceLine" id="cb93-2" title="2">rios_intersect_para <span class="op">=</span> rios_brasil.intersects(estado_para)</a>
<a class="sourceLine" id="cb93-3" title="3"></a>
<a class="sourceLine" id="cb93-4" title="4"><span class="bu">print</span>(rios_intersect_para.head(<span class="dv">5</span>))</a></code></pre></div>
<pre><code>## 0    False
## 1    False
## 2    False
## 3    False
## 4    False
## dtype: bool</code></pre>
<p>O resultado √© uma lista booleana, desta forma, vamos filtrar o conjunto de dados de rios com este √≠ndice, e ent√£o verificar quais deles fazem intersec√ß√£o com o estado do Par√°.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb95-1" title="1">rios_para <span class="op">=</span> rios_brasil[rios_intersect_para]</a></code></pre></div>
<p>Com os dados separados, vamos fazer um plot para melhor visualizar o resultado. Neste plot vamos utilizar o <code>matplotlib</code>, para criar v√°rios subplots.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb96-1" title="1"><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</a>
<a class="sourceLine" id="cb96-2" title="2"></a>
<a class="sourceLine" id="cb96-3" title="3"><span class="co"># Criando figura e os subplots</span></a>
<a class="sourceLine" id="cb96-4" title="4">fig, (ax1, ax2) <span class="op">=</span> plt.subplots(ncols<span class="op">=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb96-5" title="5"></a>
<a class="sourceLine" id="cb96-6" title="6">base <span class="op">=</span> estados_do_brasil.plot(ax <span class="op">=</span> ax1, color <span class="op">=</span> <span class="st">&#39;blue&#39;</span>)</a>
<a class="sourceLine" id="cb96-7" title="7">rios_para.plot(ax <span class="op">=</span> base, color <span class="op">=</span> <span class="st">&#39;red&#39;</span>)</a></code></pre></div>
<pre><code>## &lt;matplotlib.axes._subplots.AxesSubplot object at 0x0000028124DAF240&gt;</code></pre>
<div class="sourceCode" id="cb98"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb98-1" title="1">base <span class="op">=</span> estado_para.plot(ax <span class="op">=</span> ax2, color <span class="op">=</span> <span class="st">&#39;gray&#39;</span>)</a>
<a class="sourceLine" id="cb98-2" title="2">rios_para.plot(ax <span class="op">=</span> base, color <span class="op">=</span> <span class="st">&#39;red&#39;</span>)</a></code></pre></div>
<pre><code>## &lt;matplotlib.axes._subplots.AxesSubplot object at 0x00000281252F0A20&gt;</code></pre>
<div class="sourceCode" id="cb100"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb100-1" title="1">plt.show()</a></code></pre></div>
<p><img src="intro-analise-de-dados-espaciais_files/figure-html/unnamed-chunk-58-1.png" width="672" /></p>
<p>Veja que esta opera√ß√£o verificou somente aqueles que fazem intersec√ß√£o com as fronteiras, n√£o indicando que est√° contido ou pr√≥ximo ao estado.</p>
</div>
</div>
<div id="manipulacao-de-projecoes" class="section level3">
<h3><span class="header-section-number">3.2.5</span> Manipula√ß√£o de proje√ß√µes</h3>
<p>Uma opera√ß√£o muito importante quando se est√° trabalhando dados espaciais √© a manipula√ß√£o de suas proje√ß√µes, estas que como explicado no cap√≠tulo anterior, fazem as representa√ß√µes das geometrias no espa√ßo, o GeoPandas fornece um m√©todo muito simples para tal opera√ß√£o, o <code>to_crs</code>, que altera a proje√ß√£o dos dados sem grandes problemas.</p>
<center>
<img src="res/3_python/opgeom_tocrs.svg" />
</center>
<p>Este foi o cap√≠tulo sobre GeoPandas e suas facilidades de uso üåü, n√£o deixe de consultar a documenta√ß√£o oficial e fazer seus testes üí´.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="introducao-ao-r.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="introducao-ao-postgis.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
